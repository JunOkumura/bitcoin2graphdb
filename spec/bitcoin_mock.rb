module BitcoinMock

  def setup_mock
    provider = Bitcoin2Graphdb::Bitcoin::BlockchainProvider.new({:cache => ':memory:', :network => 'testnet'})

    testnet_mock = double('BitcoinCoreProviderTestnet Mock')
    load_block(testnet_mock)
    load_tx(testnet_mock)
    allow(provider.api).to receive(:provider).and_return(testnet_mock)
    Bitcoin2Graphdb::Bitcoin.provider = provider
  end

  private

  def load_tx(provider_mock)
    load_tx_mock(provider_mock, 'f0315ffc38709d70ad5647e22048358dd3745f3ce3874223c80a7c92fab0c8ba')
    load_tx_mock(provider_mock, '8a750f083b2d7b5166be2ea897a073830a7e5cf7dafdb54f0a6c9151b39de60b')
    load_tx_mock(provider_mock, 'f1e579409e5d6ae20424f71b5cf46b8a7fd5deb62a0b3da989c33957cf0b1b92')
    load_tx_mock(provider_mock, 'b50ddb740dae9b2b652dfe4db84e2d594e02ca9323adf3e614e1edd8b1ea6f1e')
    load_tx_mock(provider_mock, 'a983a4d0326ddb177107431515832205c843a61f0bb518be459134f3bdd035db')
    load_tx_mock(provider_mock, '05587f30d146126f5d81ff17c24177645669df3d75f69b50ae21d24e5ef162e3')
    load_tx_mock(provider_mock, 'bfab0b40e962f01a8341dec421e5183ab63a92faef4a6257d3021f0c3479b89e')
    load_tx_mock(provider_mock, '2570975c55f74f77417a3da625cf0e1903e24acdfd6c1cb51e4f3c7c0fa313f0')
    load_tx_mock(provider_mock, 'b126aacedc27d12f1d3d653bd7430d7de6ad9ccb90ab116b3f0fd66175ffb556')
    load_tx_mock(provider_mock, 'fec95562b63e293d3cc45673be80a849a33eb121f244c74a5456515b28c62b1b')
    allow(provider_mock).to receive(:get_transaction).with('f0315ffc38709d70ad5647e22048358dd3745f3ce3874223c80a7c92fab0c8ba', 0).and_return('01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0e0420e7494d017f062f503253482fffffffff0100f2052a010000002321021aeaf2f8638a129a3156fbe7e5ef635226b0bafd495ff03afe2c843d7e3a4b51ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('fec95562b63e293d3cc45673be80a849a33eb121f244c74a5456515b28c62b1b', 0).and_return('0100000001a59037c5a3e9d920b720e98ab1118c3a555b7875efa9d542177318a1e9422c0d010000006a47304402203be779be361ad79b89771e0b1eb7ac250804d8806c4601b9e912217bfbbdfc0d02206547d422257ba34423a1b4292a056f0c57ae5a368595eb70552cdb5938ee6f9a012103b4aed31422355f0399cae188510bd20bef0db077fe13eff4875baf7c84e86af7ffffffff0358020000000000001976a9141313a65b1ec5e9a6907819c536c644dc7a8e034188ac0000000000000000596a4c564f41010001e0d4034d753d68747470733a2f2f6261726261646f732d77616c6c65742e73332d61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f66696e616e636561737365742d362e6a736f6e385d0100000000001976a914a36418afb89ea7903c55c797af650dad7241470488ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('0d2c42e9a118731742d5a9ef75785b553a8c11b18ae920b720d9e9a3c53790a5', 0).and_return('010000000173419d5f11b2c83836361600ddb5db2915fbc6278a793afb0aa881d34587772f000000006a47304402203a8047f3ca1bf21fbceab91f2f8822e206b63f5723848945b16c14cc40b0c3b8022019820f54407de38cc8a91d324c616ce5ec662e857067d759061d57bafa2cd6e60121034a750b912f603eb2bd06fc1489d79f096e5428a42d1efeb88909371e85b77327ffffffff0222572e00000000001976a91447557afeabd2857467f9d0725b923dcf38271d1288aca0860100000000001976a914a36418afb89ea7903c55c797af650dad7241470488ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('b126aacedc27d12f1d3d653bd7430d7de6ad9ccb90ab116b3f0fd66175ffb556', 0).and_return('01000000057a0f85c96bfe7dac48d276b14f23329721674b4971ad0536ccc0652422bc2eee000000006b483045022100da5ee4246284df12e53685965abd7d7d07ddf07dc371c856789d5c6df565d645022047450b61f6cb7265e18d7215fe21fd7d944a678c35cbdf9dafc67d2220f4946a0121031f4dd2bf3e2a069197a11f477cca602b7bd6bad1cd330b3b0b0cf0c459451df3ffffffff854fa3262688222ae385cc05e3df6c23aab25854d399091ee831f8d826a15af7000000006b483045022100bc37188dbbbe0baaeaac42854457e8b0c392cc862f04ea11befb9b1efa0b67fe022066ed74500608a8b4856fd044c0ff8144f6a8d253c9be0cb2c084e5b3c6711a400121031f4dd2bf3e2a069197a11f477cca602b7bd6bad1cd330b3b0b0cf0c459451df3ffffffff1b2bc6285b5156544ac744f221b13ea349a880be7356c43c3d293eb66255c9fe000000006a47304402202f38075a682f42c2958cbee7248225f14810bfa6002da736c442ad398cb92d340220212feff02f239e6b855130221f513127b146f78cad3259e29e8144676ebe737c0121031f4dd2bf3e2a069197a11f477cca602b7bd6bad1cd330b3b0b0cf0c459451df3ffffffff3dad7e4609d5d3deaf28d9ee5aaced8a00991d83366b5490894ea2cecdbb5ca4010000006b483045022100f43c9833526daa19886450f9fa71aa069d2f84670dca0557cc02f0288f58754b0220700cf82b69c7571ae9b5915155cbafb84ef72d00a25a571b1a764aea0b56ddeb0121031f4dd2bf3e2a069197a11f477cca602b7bd6bad1cd330b3b0b0cf0c459451df3ffffffff020e7c8004b26ed398753674ab1a809362611fd24fe4461ab10e5299ae5f76ae010000006b483045022100f6c4088a357cd2a569fad02c0d0c09421c43be9d6444c3979e830f6a1d050f4d02206246b296faa3f0091f58e294ec2d58ecde68f831ee00b2b0317c3649a0b9ef330121031f4dd2bf3e2a069197a11f477cca602b7bd6bad1cd330b3b0b0cf0c459451df3ffffffff0800000000000000001a6a184f41010006a09c01a09c01e0d403a09c01a09c01e0d4030058020000000000001976a9140719edc9ab0e6964244c4d73f2f7cf1f2b812e5f88ac58020000000000001976a9140719edc9ab0e6964244c4d73f2f7cf1f2b812e5f88ac58020000000000001976a9140719edc9ab0e6964244c4d73f2f7cf1f2b812e5f88ac58020000000000001976a91424dfe7bcee33902093302dcd485d219a04d1aaba88ac58020000000000001976a91440d2dbf8198e80c0d0c19ed001a49076d19fe83288ac58020000000000001976a914a36418afb89ea7903c55c797af650dad7241470488ace05a0100000000001976a9141313a65b1ec5e9a6907819c536c644dc7a8e034188ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('ee2ebc222465c0cc3605ad71494b67219732234fb176d248ac7dfe6bc9850f7a', 0).and_return('010000000173419d5f11b2c83836361600ddb5db2915fbc6278a793afb0aa881d34587772f010000006b483045022100bb6b65c33c08f131e15ee05646df91e5294571f6ea5622878ef9f7c74db13980022067e1666da9b5a1877c7a87e071e753141e377d95399de8fbbb5d853d9e2ea6030121032c5fb391ff812b2cf3843968824319a05153caf0c875bf7c48e13e4d899b7969ffffffff0358020000000000001976a9141313a65b1ec5e9a6907819c536c644dc7a8e034188ac0000000000000000596a4c564f41010001a09c014d753d68747470733a2f2f6261726261646f732d77616c6c65742e73332d61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f66696e616e636561737365742d362e6a736f6e385d0100000000001976a91424dfe7bcee33902093302dcd485d219a04d1aaba88ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('2f778745d381a80afb3a798a27c6fb1529dbb5dd0016363638c8b2115f9d4173', 0).and_return('010000000137fb7f03c0276cbc15c10be8c8c1d426e68a5a5ddad9310e720b805a9361ec980c0000006b48304502210095bc59355191349371aab7806b0a717a43a689efa7819524b1537e517c5631d302205f7122390defee01e2270025cfe4fdedc91523eff67531f12df6561c6f4ad2ce0121034a750b912f603eb2bd06fc1489d79f096e5428a42d1efeb88909371e85b77327ffffffff02d2043000000000001976a91447557afeabd2857467f9d0725b923dcf38271d1288aca0860100000000001976a91424dfe7bcee33902093302dcd485d219a04d1aaba88ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('f75aa126d8f831e81e0999d35458b2aa236cdfe305cc85e32a22882626a34f85', 0).and_return('0100000001baa14d97d2583af7fa46e999cd9f83b0702b6a358d14fdda64706710e9bc63dd010000006b483045022100ec40454fcfa908119058deca8d8b6496cec4f9d4becb2ec74a2fee3a364551a102207ca7ab4c909e3a2f739fba66016c417ddf8dc00ad552dfd3dad57266c5e51b56012103366850626c511f069564647b59d74e88140df53086b92bc632f5343e411c2cb9ffffffff0358020000000000001976a9141313a65b1ec5e9a6907819c536c644dc7a8e034188ac0000000000000000596a4c564f41010001a09c014d753d68747470733a2f2f6261726261646f732d77616c6c65742e73332d61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f66696e616e636561737365742d362e6a736f6e385d0100000000001976a91440d2dbf8198e80c0d0c19ed001a49076d19fe83288ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('dd63bce910677064dafd148d356a2b70b0839fcd99e946faf73a58d2974da1ba', 0).and_return('01000000014542daac5225389af5c5275f7a59f0663c797845b42dfe0e9edbf10d758d7232000000006a47304402207963aca7ee5e0de464e578c32da056a298eba4210d5c62438881f8c9d8e0020102207619dd4734066c09906009302aa39d821557e50ebf66106752ca985bd7a4ae0b0121034a750b912f603eb2bd06fc1489d79f096e5428a42d1efeb88909371e85b77327ffffffff02c2fb2a00000000001976a91447557afeabd2857467f9d0725b923dcf38271d1288aca0860100000000001976a91440d2dbf8198e80c0d0c19ed001a49076d19fe83288ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('a45cbbcdcea24e8990546b36831d99008aedac5aeed928afded3d509467ead3d', 0).and_return('01000000027c9865a12ffa50bad312960838f24128032bb8ce2260cb8134a587c32c0e884e000000006b4830450221008a954720b807361b460e86906996ee6bce511cc59932001796f98184cbde9b5902205f0388a51519b2f43fa79543f5bfcbfd6987c02ec897075ffada3bb01aeb4f6f0121030d294c82b69c3fc742ed41b67a420b06893e50f57d6bf87e5ab45cc4b4aa62bcffffffff7c9865a12ffa50bad312960838f24128032bb8ce2260cb8134a587c32c0e884e020000006a47304402201416f66338e8a53b60bcd7210058c888aae0e0c514e0846d6f436b248fea3da1022054643dabfb1ceede59cbec8c3a9fe340316665d7a031776ee16711954fa9d9070121030d294c82b69c3fc742ed41b67a420b06893e50f57d6bf87e5ab45cc4b4aa62bcffffffff0300000000000000000b6a094f41010001a08d060058020000000000001976a9141313a65b1ec5e9a6907819c536c644dc7a8e034188ac28360100000000001976a9140719edc9ab0e6964244c4d73f2f7cf1f2b812e5f88ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('4e880e2cc387a53481cb6022ceb82b032841f238089612d3ba50fa2fa165987c', 0).and_return('010000000107930275fdd5660e1f2f64fc410dcf2113bc8451bf98c33fa433e030cf20f36e010000006b483045022100af97295235ab1dba064e488c4da2b569d1405f1740f9e13088323475a0ba47120220352d3eb9c6725e113cdaee72c7fb13d625a4baea7af96da52205a56f816842f00121030d294c82b69c3fc742ed41b67a420b06893e50f57d6bf87e5ab45cc4b4aa62bcffffffff0358020000000000001976a9140719edc9ab0e6964244c4d73f2f7cf1f2b812e5f88ac0000000000000000566a4c534f41010001a08d064a753d68747470733a2f2f6261726261646f732d77616c6c65742e73332d61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f6c6f616e61737365742d362e6a736f6e385d0100000000001976a9140719edc9ab0e6964244c4d73f2f7cf1f2b812e5f88ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('6ef320cf30e033a43fc398bf5184bc1321cf0d41fc642f1f0e66d5fd75029307', 0).and_return('010000000137fb7f03c0276cbc15c10be8c8c1d426e68a5a5ddad9310e720b805a9361ec980d0000006a473044022002f288bd80c772cd113430fbbc05a8dc131b732c27cfa638831226c24478229c02201cc29346fca02035e8631ce749409aef4385250b04612a31f5b44f1bacab33ee0121034a750b912f603eb2bd06fc1489d79f096e5428a42d1efeb88909371e85b77327ffffffff02d2043000000000001976a91447557afeabd2857467f9d0725b923dcf38271d1288aca0860100000000001976a9140719edc9ab0e6964244c4d73f2f7cf1f2b812e5f88ac00000000')
    allow(provider_mock).to receive(:get_transaction).with('ae765fae99520eb11a46e44fd21f616293801aab74367598d36eb204807c0e02', 0).and_return('01000000012c9753f40f933e007a0c2e6a084ab4690aff01f934760042d51ff2debe661a29000000006b483045022100f97b4036eabb78378971476786494e72d533381c7f4b238fb05c846c2adc065102205e533ef3b95afd6140c67677f276f9db61d71837721ca9cee5b3f6e33f3d8dfa0121034a750b912f603eb2bd06fc1489d79f096e5428a42d1efeb88909371e85b77327ffffffff0222572e00000000001976a91447557afeabd2857467f9d0725b923dcf38271d1288aca0860100000000001976a9141313a65b1ec5e9a6907819c536c644dc7a8e034188ac00000000')

  end

  def load_block(provider_mock)
    load_block_mock(provider_mock, 0, '000000000933ea01ad0ee984209779baaec3ced90fa3f408719526f8d77f4943')
    load_block_mock(provider_mock, 722039, '0000000000001521a7fd176803e2a7c3b327617319837144d6fa326fad56641e')
    load_block_mock(provider_mock, 721046, '00000000000036ffc3e2e3c247bab16e151be44a34207f822ffd7c7b879541cb')
  end

  def load_block_mock(mock, block_height, block_hash)
    allow(mock).to receive(:getblockhash).with(block_height).and_return(block_hash)
    allow(mock).to receive(:getblock).with(block_hash).and_return(fixture_file("block/#{block_hash}.json"))
  end

  def load_tx_mock(mock, txid)
    allow(mock).to receive(:getrawtransaction).with(txid, 1).and_return(fixture_file("tx/#{txid}.json"))
  end

end
